<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" id="theme-meta" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Shwe Calculator Pro | Premium</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

    <style>
        :root {
            /* Metallic Color Palette */
            --gold-primary: #fcc103;
            --gold-gradient: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --platinum-gradient: linear-gradient(135deg, #e5e5e5, #ffffff, #d1d1d1, #ffffff, #e5e5e5);
            --diamond-glow: 0 0 15px rgba(185, 242, 255, 0.5);
            
            --bg-dark: #0a0a0b;
            --glass-card: rgba(30, 30, 30, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-dim: #a0a0a0;
            
            /* Safe Areas */
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        [data-theme="light"] {
            --bg-dark: #f0f2f5;
            --glass-card: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(0, 0, 0, 0.1);
            --text-main: #1a1a1a;
            --text-dim: #666666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1a1a1a 0%, #0a0a0b 100%);
            color: var(--text-main);
            margin: 0; padding: 0;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            transition: background 0.4s ease;
        }

        /* Premium Glassmorphism Container */
        .glass-effect {
            background: var(--glass-card);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        header {
            padding: calc(20px + var(--safe-top)) 20px 20px;
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid var(--glass-border);
        }

        .premium-logo {
            font-weight: 900;
            letter-spacing: 2px;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.1rem;
        }

        .container {
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: calc(100px + var(--safe-bottom));
        }

        h2 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-dim);
            margin: 25px 0 10px 10px;
            display: flex; align-items: center;
        }

        h2::after {
            content: "";
            height: 1px;
            flex-grow: 1;
            background: var(--glass-border);
            margin-left: 15px;
        }

        .card {
            margin-bottom: 20px;
            padding: 20px;
            transition: transform 0.2s ease;
        }

        /* Inputs & Labels */
        label {
            display: block;
            font-size: 0.85rem;
            color: var(--gold-primary);
            margin-bottom: 8px;
            font-weight: 600;
            opacity: 0.9;
        }

        input, select {
            width: 100%;
            padding: 14px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: #fff;
            font-size: 18px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        [data-theme="light"] input { color: #000; background: rgba(0,0,0,0.05); }

        input:focus {
            outline: none;
            border-color: var(--gold-primary);
            background: rgba(252, 193, 3, 0.05);
            box-shadow: 0 0 15px rgba(252, 193, 3, 0.2);
        }

        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

        /* Premium Buttons */
        .btn-main {
            width: 100%;
            padding: 18px;
            border-radius: 15px;
            border: none;
            font-weight: 800;
            font-size: 1.1rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: var(--gold-gradient);
            color: #2a1e00;
            box-shadow: 0 4px 15px rgba(191, 149, 63, 0.4);
            margin-top: 20px;
            transition: all 0.3s active;
        }

        .btn-main:active { transform: scale(0.98); opacity: 0.9; }

        .btn-diamond {
            background: var(--platinum-gradient);
            color: #333;
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
        }

        .btn-reset {
            width: 100%;
            background: transparent;
            color: #ff6b6b;
            border: 1px solid rgba(255, 107, 107, 0.3);
            padding: 12px;
            border-radius: 12px;
            margin-top: 15px;
            font-weight: 600;
        }

        /* Sidebar Styling */
        .sidebar {
            height: 100%; width: 0; position: fixed; z-index: 2000;
            top: 0; left: 0; background: #000; overflow-x: hidden;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding-top: calc(60px + var(--safe-top));
        }

        .sidebar a {
            padding: 18px 30px;
            text-decoration: none;
            font-size: 1.1rem;
            color: var(--text-main);
            display: block;
            border-bottom: 1px solid var(--glass-border);
            transition: 0.3s;
        }

        .sidebar a:active { background: var(--gold-primary); color: #000; }

        /* Result Displays */
        .highlight-box {
            background: rgba(252, 193, 3, 0.08);
            border: 1px solid rgba(252, 193, 3, 0.3);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-top: 20px;
        }

        .main-ans {
            font-size: 2.2rem;
            font-weight: 800;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
        }

        .diamond-ans {
            background: var(--platinum-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tab-container {
            display: flex; gap: 8px; margin-bottom: 15px;
            background: rgba(255,255,255,0.05); padding: 5px; border-radius: 12px;
        }
        .tab {
            flex: 1; padding: 10px; border: none; border-radius: 8px;
            background: transparent; color: var(--text-dim); font-weight: bold;
        }
        .tab.active {
            background: var(--glass-card); color: var(--gold-primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .hidden { display: none !important; }
        
        /* Overlay */
        .overlay {
            display: none; position: fixed; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            z-index: 1500; top:0; left:0;
        }
    </style>
</head>
<body data-theme="dark">

    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" style="position:absolute; top: 20px; right:25px; font-size:35px;" onclick="closeNav()">&times;</a>
        <div style="padding: 0 30px 20px;"><h3 style="color:var(--gold-primary); letter-spacing:1px;">MENU</h3></div>
        <a onclick="showView('price-calc')">üí∞ ·Äõ·ÄΩ·Äæ·Ä±·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏·Äê·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫</a>
        <a onclick="showView('purity-calc')">‚öñÔ∏è ·Ä°·ÄÅ·Ä±·Ä´·ÄÄ·Ä∫·ÄÅ·Äª·ÄΩ·Äê·Ä∫/·Ä°·Äõ·Ää·Ä∫·Äê·ÄΩ·ÄÄ·Ä∫</a>
        <a onclick="showView('diamond-calc')">üíé ·ÄÖ·Ä≠·Äî·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Äõ·Äê·Äî·Ä¨·Äê·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫</a>
        <a onclick="showView('unit-converter')">‚öñÔ∏è ·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫</a>
        <a onclick="showView('net-weight')">‚öñÔ∏è ·Ä°·Äû·Ä¨·Ä∏·Äê·ÄÑ·Ä∫·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫</a>
        <a onclick="resetAllData()" style="color:#ff4444; margin-top:40px; border-top: 1px solid #333;">‚ö†Ô∏è ·Äí·Ä±·Äê·Ä¨·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·Äñ·Äª·ÄÄ·Ä∫·Äô·Ää·Ä∫</a>
    </div>
    <div id="overlay" class="overlay" onclick="closeNav()"></div>

    <header>
        <div style="display: flex; align-items: center;">
            <span style="font-size:1.5rem; cursor:pointer; color:var(--gold-primary); margin-right:20px;" onclick="openNav()">&#9776;</span>
            <span id="nav-title" class="premium-logo">SHWE CALCULATOR PRO</span>
        </div>
        <div style="cursor:pointer; font-size:1.4rem;" onclick="toggleTheme()" id="theme-icon">üåô</div>
    </header>

    <div class="container">
        
        <div id="price-calc-view">
            <h2>·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫</h2>
            <div class="card glass-effect">
                <label>·Äö·Äî·Ä±·Ä∑·Äï·Ä±·Ä´·ÄÄ·Ä∫·Äà·Ä±·Ä∏ (·ÄÄ·Äª·Äï·Ä∫)</label>
                <input type="number" id="GoldPrice" inputmode="numeric" placeholder="0">
            </div>

            <h2>·Äõ·ÄΩ·Äæ·Ä±·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫</h2>
            <div class="card glass-effect grid-3">
                <div><label>·ÄÄ·Äª·Äï·Ä∫</label><input type="number" id="PKat" inputmode="numeric"></div>
                <div><label>·Äï·Ä≤</label><input type="number" id="PPe" inputmode="numeric"></div>
                <div><label>·Äõ·ÄΩ·Ä±·Ä∏</label><input type="number" id="PYway" inputmode="decimal"></div>
            </div>

            <h2>·Ä°·Äú·Äª·Ä±·Ä¨·Ä∑·Äê·ÄΩ·ÄÄ·Ä∫</h2>
            <div class="card glass-effect grid-3">
                <div><label>·ÄÄ·Äª·Äï·Ä∫</label><input type="number" id="RKat" inputmode="numeric"></div>
                <div><label>·Äï·Ä≤</label><input type="number" id="RPae" inputmode="numeric"></div>
                <div><label>·Äõ·ÄΩ·Ä±·Ä∏</label><input type="number" id="RYway" inputmode="decimal"></div>
            </div>

            <h2>·Ä°·Äï·Ä≠·ÄØ·ÄÜ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏</h2>
            <div class="card glass-effect">
                <div class="grid-3" style="grid-template-columns: 1fr 1fr; gap:20px;">
                    <div><label>·Äú·ÄÄ·Ä∫·ÄÅ (·ÄÄ·Äª·Äï·Ä∫)</label><input type="number" id="Smith" inputmode="numeric"></div>
                    <div><label>·ÄÄ·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äñ·Ä≠·ÄØ·Ä∏ (·ÄÄ·Äª·Äï·Ä∫)</label><input type="number" id="StonePrice" inputmode="numeric"></div>
                </div>
            </div>
            
            <button class="btn-main" onclick="calculatePrice()">·Äê·ÄΩ·ÄÄ·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äô·Ää·Ä∫</button>
            <button class="btn-reset" onclick="resetCalculator()">RESET</button>
        </div>

        <div id="purity-calc-view" class="hidden">
            <h2>Purity Analysis</h2>
            <div class="tab-container glass-effect">
                <button id="tab-purity" class="tab active" onclick="switchPurityTab('purity')">·Ä°·Äõ·Ää·Ä∫·Ä°·Äû·ÄΩ·Ä±·Ä∏</button>
                <button id="tab-yield" class="tab" onclick="switchPurityTab('yield')">·Ä°·Äû·Ä¨·Ä∏·Äê·ÄÑ·Ä∫·Äë·ÄΩ·ÄÄ·Ä∫·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏</button>
            </div>

            <div id="purity-sub-view">
                <div class="card glass-effect">
                    <label>·Ä°·Äë·Ää·Ä∫·Äï·Äª·ÄÄ·Ä∫ ·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫</label>
                    <div class="grid-3">
                        <input type="number" id="p1-k" placeholder="K">
                        <input type="number" id="p1-p" placeholder="P">
                        <input type="number" id="p1-y" placeholder="Y">
                    </div>
                </div>
                <div class="card glass-effect">
                    <label>·ÄÅ·Äª·ÄΩ·Äê·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äõ·Äõ·Äæ·Ä≠·Äû·Ä±·Ä¨ ·Ä°·ÄÅ·Ä±·Ä´·ÄÄ·Ä∫·Äõ·ÄΩ·Äæ·Ä±</label>
                    <div class="grid-3">
                        <input type="number" id="p2-k" placeholder="K">
                        <input type="number" id="p2-p" placeholder="P">
                        <input type="number" id="p2-y" placeholder="Y">
                    </div>
                </div>
                <button class="btn-main" onclick="calcPurity()">·Äê·ÄΩ·ÄÄ·Ä∫·Äô·Ää·Ä∫</button>
            </div>

            <div id="yield-sub-view" class="hidden">
                <div class="card glass-effect">
                    <label>·Ä°·Äë·Ää·Ä∫·Äï·Äª·ÄÄ·Ä∫ ·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫</label>
                    <div class="grid-3">
                        <input type="number" id="y1-k" placeholder="K">
                        <input type="number" id="y1-p" placeholder="P">
                        <input type="number" id="y1-y" placeholder="Y">
                    </div>
                </div>
                <div class="card glass-effect">
                    <label>·ÄÖ·ÄÄ·Ä∫·Äï·ÄΩ·Ä≠·ÄØ·ÄÑ·Ä∑·Ä∫ (Density) / ·Äï·Ä≤·Äõ·Ää·Ä∫</label>
                    <input type="number" id="y-den" placeholder="Density (e.g. 17.51)" style="margin-bottom:12px;">
                    <input type="number" id="y-pe" placeholder="·Äï·Ä≤·Äõ·Ää·Ä∫ (e.g. 15)">
                </div>
                <button class="btn-main" onclick="calcYield()">·Äë·ÄΩ·ÄÄ·Ä∫·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏·Äê·ÄΩ·ÄÄ·Ä∫·Äô·Ää·Ä∫</button>
            </div>

            <div id="purity-result" class="highlight-box hidden">
                <label id="p-res-label">RESULT</label>
                <div id="p-res-val" class="main-ans">0.00</div>
                <div id="p-res-detail" style="font-size:0.9rem; color:var(--text-dim);"></div>
            </div>
        </div>

        <div id="diamond-calc-view" class="hidden">
            <h2 style="color: #b9f2ff;">Diamond Valuation</h2>
            <div class="card glass-effect">
                <label style="color: #b9f2ff;">Price Basis</label>
                <select id="DiamondPriceType" style="margin-bottom:15px;" onchange="updateEquivPrice()">
                    <option value="carat">Per Carat (·ÄÄ·Ä¨·Äõ·ÄÄ·Ä∫·Äà·Ä±·Ä∏)</option>
                    <option value="ratti">Per Ratti (·Äõ·Äê·ÄÆ·Äà·Ä±·Ä∏)</option>
                </select>
                <label style="color: #b9f2ff;">Rate (·ÄÄ·Äª·Äï·Ä∫)</label>
                <input type="number" id="DiamondPrice" placeholder="Enter Price..." oninput="updateEquivPrice()">
                <div id="equivPriceDisplay" style="font-size: 0.8rem; color: #b9f2ff; margin-top: 10px; font-style: italic; opacity:0.7;"></div>
            </div>

            <div class="card glass-effect">
                <label style="color: #b9f2ff;">Carat (Ct)</label>
                <input type="number" id="DCt" step="0.0001" placeholder="0.00" oninput="syncDiamondUnits('ct')">
                <div style="margin: 20px 0; height:1px; background:var(--glass-border);"></div>
                <div class="grid-3">
                    <div><label style="color: #b9f2ff;">Ratti</label><input type="number" id="DR" oninput="syncDiamondUnits('unit')"></div>
                    <div><label style="color: #b9f2ff;">Bree</label><input type="number" id="DB" oninput="syncDiamondUnits('unit')"></div>
                    <div><label style="color: #b9f2ff;">Paing</label><input type="number" id="DP" oninput="syncDiamondUnits('unit')"></div>
                </div>
            </div>

            <button class="btn-main btn-diamond" onclick="calculateDiamondPrice()">Calculate Diamond</button>
            <button class="btn-reset" onclick="resetDiamond()">RESET</button>
        </div>

        <div id="unit-converter-view" class="hidden">
            <h2>Weight Converter</h2>
            <div class="card glass-effect">
                <label>Grams (g)</label>
                <input type="number" id="gramsInput" placeholder="Enter grams...">
                <div style="margin:20px 0; height:1px; background:var(--glass-border);"></div>
                <div class="grid-3">
                    <div><label>·ÄÄ·Äª·Äï·Ä∫</label><input type="number" id="uKyat"></div>
                    <div><label>·Äï·Ä≤</label><input type="number" id="uPe"></div>
                    <div><label>·Äõ·ÄΩ·Ä±·Ä∏</label><input type="number" id="uYway"></div>
                </div>
                <select id="standard" style="margin-top:15px;" onchange="convertUnits('grams')">
                    <option value="16.329325">Official Standard (16.329g)</option>
                    <option value="16.606">Traditional Standard (16.606g)</option>
                </select>
            </div>
            
            <div class="highlight-box">
                <div id="uDisplay" class="main-ans">·ÅÄ ·ÄÄ·Äª·Äï·Ä∫ ·ÅÄ ·Äï·Ä≤ ·ÅÄ ·Äõ·ÄΩ·Ä±·Ä∏</div>
                <div id="uSubDisplay" style="color:var(--text-dim);"></div>
            </div>
        </div>

        <div id="net-weight-view" class="hidden">
            <h2>Net Weight Calculation</h2>
            <div class="card glass-effect">
                <label>Total Weight (·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏)</label>
                <div class="grid-3">
                    <input type="number" id="TKat" placeholder="K" oninput="calculateNetWeight()">
                    <input type="number" id="TPe" placeholder="P" oninput="calculateNetWeight()">
                    <input type="number" id="TYway" placeholder="Y" oninput="calculateNetWeight()">
                </div>
            </div>
            <div class="card glass-effect">
                <label>Subtract Stones/Other (·Äî·Äæ·ÄØ·Äê·Ä∫·Äõ·Äî·Ä∫)</label>
                <div class="grid-3">
                    <input type="number" id="SKat" placeholder="K" oninput="calculateNetWeight()">
                    <input type="number" id="SPe" placeholder="P" oninput="calculateNetWeight()">
                    <input type="number" id="SYway" placeholder="Y" oninput="calculateNetWeight()">
                </div>
            </div>
            <div class="highlight-box">
                <label>Net Gold Weight</label>
                <div id="netDisplay" class="main-ans">·ÅÄ ·ÄÄ·Äª·Äï·Ä∫ ·ÅÄ ·Äï·Ä≤ ·ÅÄ ·Äõ·ÄΩ·Ä±·Ä∏</div>
                <div id="netSubDisplay" style="color:var(--text-dim);">(0.0000 ·ÄÄ·Äª·Äï·Ä∫)</div>
            </div>
        </div>

        <div id="price-result-view" class="hidden">
            <div id="capture-area" class="card glass-effect" style="background: #111; border: 2px solid #bf953f;">
                <h3 id="res-title" style="text-align:center; color:var(--gold-primary); margin-top:0;">INVOICE</h3>
                <div id="res-list" style="margin:20px 0;"></div>
            </div>
            <button class="btn-main" style="background: #2ecc71; color:white;" onclick="saveAsPhoto()">üì∑ SAVE IMAGE</button>
            <button id="res-back-btn" class="btn-reset" style="border-color:#555; color:#aaa;" onclick="showView('price-calc')">BACK</button>
        </div>

    </div>

    <script>
        // --- UI Logic ---
        function openNav() { document.getElementById("mySidebar").style.width = "280px"; document.getElementById("overlay").style.display = "block"; }
        function closeNav() { document.getElementById("mySidebar").style.width = "0"; document.getElementById("overlay").style.display = "none"; }

        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            const mode = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', mode);
            icon.innerText = mode === 'dark' ? "üåô" : "‚òÄÔ∏è";
            localStorage.setItem('theme', mode);
        }

        function showView(view) {
            const views = ['price-calc-view', 'diamond-calc-view', 'unit-converter-view', 'net-weight-view', 'price-result-view', 'purity-calc-view'];
            views.forEach(v => document.getElementById(v).classList.add('hidden'));
            document.getElementById(view + '-view').classList.remove('hidden');
            
            const title = document.getElementById('nav-title');
            if(view === 'diamond-calc') {
                title.innerText = "DIAMOND PRO";
                title.style.background = "var(--platinum-gradient)";
                title.style.webkitBackgroundClip = "text";
            } else {
                title.innerText = "SHWE CALCULATOR PRO";
                title.style.background = "var(--gold-gradient)";
                title.style.webkitBackgroundClip = "text";
            }
            closeNav();
            window.scrollTo(0,0);
        }

        function switchPurityTab(type) {
            document.getElementById('tab-purity').classList.toggle('active', type === 'purity');
            document.getElementById('tab-yield').classList.toggle('active', type === 'yield');
            document.getElementById('purity-sub-view').classList.toggle('hidden', type !== 'purity');
            document.getElementById('yield-sub-view').classList.toggle('hidden', type !== 'yield');
        }

        // --- Calculation Logic ---
        function toDecimal(k, p, y) { return (parseFloat(k)||0) + ((parseFloat(p)||0)/16) + ((parseFloat(y)||0)/128); }

        function fromDecimal(decimal) {
            let k = Math.floor(decimal + 0.0000001);
            let remPe = (decimal - k) * 16;
            let p = Math.floor(remPe + 0.0000001);
            let y = parseFloat(((remPe - p) * 8).toFixed(2));
            if(y >= 8) { p++; y = 0; }
            if(p >= 16) { k++; p = 0; }
            return `${k} ·ÄÄ·Äª·Äï·Ä∫ ${p} ·Äï·Ä≤ ${y} ·Äõ·ÄΩ·Ä±·Ä∏`;
        }

        function calculatePrice() {
            const price = parseFloat(document.getElementById('GoldPrice').value) || 0;
            const goldKyat = toDecimal(document.getElementById('PKat').value, document.getElementById('PPe').value, document.getElementById('PYway').value);
            const redKyat = toDecimal(document.getElementById('RKat').value, document.getElementById('RPae').value, document.getElementById('RYway').value);
            const smith = parseFloat(document.getElementById('Smith').value) || 0;
            const stone = parseFloat(document.getElementById('StonePrice').value) || 0;
            
            const goldCost = goldKyat * price;
            const redCost = redKyat * price;
            const total = goldCost + redCost + smith + stone;

            const resList = document.getElementById('res-list');
            resList.innerHTML = `
                <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #333;"><span>·Äõ·ÄΩ·Äæ·Ä±·Äñ·Ä≠·ÄØ·Ä∏</span><span>${Math.round(goldCost).toLocaleString()}</span></div>
                <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #333;"><span>·Äú·Äª·Ä±·Ä¨·Ä∑·Äê·ÄΩ·ÄÄ·Ä∫·Äñ·Ä≠·ÄØ·Ä∏</span><span>${Math.round(redCost).toLocaleString()}</span></div>
                <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #333;"><span>·Äú·ÄÄ·Ä∫·ÄÅ/·ÄÄ·Äª·Ä±·Ä¨·ÄÄ·Ä∫</span><span>${(smith+stone).toLocaleString()}</span></div>
                <div style="margin-top:20px; font-size:1.8rem; text-align:center; color:var(--gold-primary); font-weight:bold;">${Math.round(total).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫</div>
            `;
            showView('price-result');
        }

        // --- Diamond Logic ---
        function updateEquivPrice() {
            const price = parseFloat(document.getElementById('DiamondPrice').value) || 0;
            const type = document.getElementById('DiamondPriceType').value;
            const disp = document.getElementById('equivPriceDisplay');
            if(!price) { disp.innerText = ""; return; }
            disp.innerText = type === 'carat' 
                ? `‚âà ${Math.round(price/1.1).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫ (·ÅÅ ·Äõ·Äê·ÄÆ·Äú·Äª·Äæ·ÄÑ·Ä∫)`
                : `‚âà ${Math.round(price*1.1).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫ (·ÅÅ ·ÄÄ·Ä¨·Äõ·ÄÄ·Ä∫·Äú·Äª·Äæ·ÄÑ·Ä∫)`;
        }

        function syncDiamondUnits(mode) {
            let dr = document.getElementById('DR'), db = document.getElementById('DB'), dp = document.getElementById('DP'), dct = document.getElementById('DCt');
            if (mode === 'ct') {
                const totalRatti = (parseFloat(dct.value) || 0) * 1.1;
                const r = Math.floor(totalRatti + 0.00001);
                const remB = (totalRatti - r) * 20;
                const b = Math.floor(remB + 0.00001);
                const p = parseFloat(((remB - b) * 8).toFixed(2));
                dr.value = r || ""; db.value = b || ""; dp.value = p > 0 ? p : "";
            } else {
                const totalRatti = (parseFloat(dr.value)||0) + ((parseFloat(db.value)||0)/20) + ((parseFloat(dp.value)||0)/160);
                dct.value = (totalRatti / 1.1).toFixed(4);
            }
        }

        function calculateDiamondPrice() {
            const price = parseFloat(document.getElementById('DiamondPrice').value) || 0;
            const type = document.getElementById('DiamondPriceType').value;
            const ct = parseFloat(document.getElementById('DCt').value) || 0;
            const totalRatti = (parseFloat(document.getElementById('DR').value)||0) + ((parseFloat(document.getElementById('DB').value)||0)/20) + ((parseFloat(document.getElementById('DP').value)||0)/160);
            const total = type === 'carat' ? ct * price : totalRatti * price;

            document.getElementById('res-title').innerText = "DIAMOND QUOTE";
            document.getElementById('res-list').innerHTML = `
                <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #333;"><span>·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫</span><span>${ct} Carat</span></div>
                <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #333;"><span>·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏</span><span>${price.toLocaleString()}</span></div>
                <div style="margin-top:20px; font-size:1.8rem; text-align:center; color:#b9f2ff; font-weight:bold;">${Math.round(total).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫</div>
            `;
            showView('price-result');
        }

        // --- Purity Logic ---
        function calcPurity() {
            let raw = toDecimal(document.getElementById('p1-k').value, document.getElementById('p1-p').value, document.getElementById('p1-y').value);
            let pure = toDecimal(document.getElementById('p2-k').value, document.getElementById('p2-p').value, document.getElementById('p2-y').value);
            if(raw <= 0 || pure <= 0) return alert("Enter weight");
            let peYee = (pure / raw) * 16;
            let density = (pure / raw) * 19.32;
            document.getElementById('purity-result').classList.remove('hidden');
            document.getElementById('p-res-val').innerText = `${peYee.toFixed(2)} ·Äï·Ä≤·Äõ·Ää·Ä∫`;
            document.getElementById('p-res-detail').innerText = `Density: ${density.toFixed(2)}`;
        }

        function calcYield() {
            let raw = toDecimal(document.getElementById('y1-k').value, document.getElementById('y1-p').value, document.getElementById('y1-y').value);
            let den = parseFloat(document.getElementById('y-den').value);
            let pe = parseFloat(document.getElementById('y-pe').value);
            let res = den > 0 ? (den / 19.32) * raw : (pe / 16) * raw;
            if(!res) return alert("Enter Density or Pe-Yee");
            document.getElementById('purity-result').classList.remove('hidden');
            document.getElementById('p-res-val').innerText = fromDecimal(res);
            document.getElementById('p-res-detail').innerText = `Decimal: ${res.toFixed(5)} K`;
        }

        // --- Helper Logic ---
        function calculateNetWeight() {
            const total = toDecimal(document.getElementById('TKat').value, document.getElementById('TPe').value, document.getElementById('TYway').value);
            const sub = toDecimal(document.getElementById('SKat').value, document.getElementById('SPe').value, document.getElementById('SYway').value);
            const net = Math.max(0, total - sub);
            document.getElementById('netDisplay').innerText = fromDecimal(net);
            document.getElementById('netSubDisplay').innerText = `(${net.toFixed(4)} ·ÄÄ·Äª·Äï·Ä∫)`;
        }

        function convertUnits(source) {
            const factor = parseFloat(document.getElementById('standard').value);
            let kDec = source === 'grams' ? (parseFloat(document.getElementById('gramsInput').value)||0)/factor : toDecimal(document.getElementById('uKyat').value, document.getElementById('uPe').value, document.getElementById('uYway').value);
            document.getElementById('uDisplay').innerText = fromDecimal(kDec);
            document.getElementById('uSubDisplay').innerText = `${(kDec * factor).toFixed(3)} g`;
            if(source === 'grams') {
                const parts = fromDecimal(kDec).match(/\d+(\.\d+)?/g);
                document.getElementById('uKyat').value = parts[0]; document.getElementById('uPe').value = parts[1]; document.getElementById('uYway').value = parts[2];
            } else { document.getElementById('gramsInput').value = (kDec * factor).toFixed(3); }
        }

        function resetAllData() {
            if(confirm("Clear all data?")) { localStorage.clear(); location.reload(); }
        }

        function saveAsPhoto() {
            const area = document.getElementById("capture-area");
            html2canvas(area, { backgroundColor: '#111', scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `ShweCalc_${Date.now()}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // Event Listeners
        document.getElementById('gramsInput').addEventListener('input', () => convertUnits('grams'));
        ['uKyat', 'uPe', 'uYway'].forEach(id => document.getElementById(id).addEventListener('input', () => convertUnits('unit')));
        
        window.onload = () => {
            const theme = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', theme);
            document.getElementById('theme-icon').innerText = theme === 'dark' ? "üåô" : "‚òÄÔ∏è";
        };
    </script>
</body>
</html>
