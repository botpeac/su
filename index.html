<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" id="theme-meta" content="#1a1a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Shwe Calculator Pro | Premium</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

    <style>
        :root {
            /* Premium Metallic Palette */
            --gold-primary: #d4af37;
            --gold-gradient: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 70%, #fbf5b7 100%);
            --diamond-gradient: linear-gradient(135deg, #e0f7fa 0%, #b9f2ff 50%, #80deea 100%);
            --silver-gradient: linear-gradient(135deg, #757575 0%, #e0e0e0 50%, #9e9e9e 100%);
            
            /* Glassmorphism Variables */
            --bg: #0a0b0d;
            --card-glass: rgba(255, 255, 255, 0.03);
            --card-border: rgba(255, 255, 255, 0.08);
            --input-glass: rgba(0, 0, 0, 0.3);
            --text: #e0e0e0;
            --text-dim: #a0a0a0;
            
            /* Safe Areas */
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        [data-theme="light"] {
            --bg: #f0f2f5;
            --card-glass: rgba(255, 255, 255, 0.8);
            --card-border: rgba(0, 0, 0, 0.05);
            --input-glass: #ffffff;
            --text: #1a1a1a;
            --text-dim: #666666;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(circle at top right, rgba(212, 175, 55, 0.05), transparent),
                              radial-gradient(circle at bottom left, rgba(185, 242, 255, 0.05), transparent);
            color: var(--text);
            margin: 0; padding: 0; overflow-x: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- Glass Header --- */
        header {
            background: rgba(10, 11, 13, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: calc(15px + var(--safe-top)) 20px 15px 20px;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid var(--card-border);
            position: sticky; top: 0; z-index: 900;
        }

        #nav-title {
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800; letter-spacing: 1px; font-size: 0.9rem;
        }

        /* --- Containers & Cards --- */
        .container {
            padding: 20px; max-width: 480px; margin: auto;
            padding-bottom: calc(100px + var(--safe-bottom));
        }

        .card {
            background: var(--card-glass);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 20px; border-radius: 24px;
            border: 1px solid var(--card-border);
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h2 {
            font-size: 0.85rem; text-transform: uppercase; letter-spacing: 2px;
            color: var(--gold-primary); margin-bottom: 15px; margin-top: 5px;
            display: flex; align-items: center; gap: 10px;
        }

        h2::after {
            content: ""; flex: 1; height: 1px; 
            background: linear-gradient(90deg, var(--gold-primary), transparent);
        }

        /* --- Premium Inputs --- */
        label { 
            display: block; font-size: 0.75rem; color: var(--text-dim); 
            margin-bottom: 8px; font-weight: 600; text-transform: uppercase;
        }

        input, select {
            width: 100%; padding: 14px 18px; 
            background: var(--input-glass);
            border: 1px solid var(--card-border);
            border-radius: 14px; color: #fff;
            font-size: 18px; font-weight: 500;
            transition: all 0.3s ease;
        }

        input:focus {
            border-color: var(--gold-primary);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.1);
            outline: none;
            background: rgba(255,255,255,0.05);
        }

        /* --- Metallic Buttons --- */
        .btn-main {
            width: 100%; padding: 18px; 
            background: var(--gold-gradient);
            color: #1a1a1a; border: none; border-radius: 16px;
            font-weight: 800; font-size: 1.1rem; cursor: pointer;
            box-shadow: 0 4px 20px rgba(191, 149, 63, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase; letter-spacing: 1px;
        }

        .btn-main:active { transform: scale(0.98); }

        .btn-diamond {
            background: var(--diamond-gradient);
            box-shadow: 0 4px 20px rgba(185, 242, 255, 0.3);
        }

        .btn-reset {
            width: 100%; padding: 12px; background: transparent;
            color: #ff6b6b; border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 14px; margin-top: 15px; cursor: pointer;
            font-size: 0.9rem; font-weight: 600;
        }

        /* --- Tabs --- */
        .tab-container {
            display: flex; background: var(--input-glass);
            padding: 5px; border-radius: 15px; margin-bottom: 20px;
            border: 1px solid var(--card-border);
        }

        .tab {
            flex: 1; padding: 10px; border: none; background: transparent;
            color: var(--text-dim); border-radius: 12px; font-weight: 600;
        }

        .tab.active {
            background: var(--gold-gradient); color: #000;
        }

        /* --- Results Area --- */
        .highlight-box {
            background: radial-gradient(circle at center, rgba(212,175,55,0.1), transparent);
            border: 1px solid var(--gold-primary);
            padding: 25px; border-radius: 24px; text-align: center;
        }

        .main-ans {
            font-size: 2.2rem; font-weight: 800;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
        }

        .total-row {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--gold-primary);
            padding: 20px; border-radius: 18px; margin-top: 20px;
        }

        /* --- Sidebar & Overlay --- */
        .sidebar {
            height: 100%; width: 0; position: fixed; z-index: 1000;
            top: 0; left: 0; background: #0a0b0d; overflow-x: hidden;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-right: 1px solid var(--card-border);
            padding-top: calc(40px + var(--safe-top));
        }

        .sidebar a {
            padding: 18px 30px; text-decoration: none; font-size: 1.1rem;
            color: var(--text-dim); display: flex; align-items: center; gap: 15px;
            transition: 0.3s;
        }

        .sidebar a:hover { color: var(--gold-primary); background: rgba(255,255,255,0.02); }

        .overlay {
            display: none; position: fixed; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            z-index: 999; top:0; left:0;
        }

        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        .hidden { display: none; }

        /* Utility */
        .theme-toggle {
            width: 40px; height: 40px; display: flex; align-items: center;
            justify-content: center; border-radius: 12px;
            background: var(--card-glass); border: 1px solid var(--card-border);
        }

    </style>
</head>
<body data-theme="dark">

    <div class="app-wrapper">
        <div id="mySidebar" class="sidebar">
            <a href="javascript:void(0)" style="position:absolute; top: 20px; right:25px; font-size:30px;" onclick="closeNav()">&times;</a>
            <div style="padding: 20px 30px;"><h3 style="color:var(--gold-primary); margin:0; letter-spacing: 1px;">MENU</h3></div>
            <a onclick="showView('price-calc')">üí∞ <span style="margin-left:5px">·Äõ·ÄΩ·Äæ·Ä±·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏·Äê·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫</span></a>
            <a onclick="showView('purity-calc')">‚öñÔ∏è <span style="margin-left:5px">·Ä°·ÄÅ·Ä±·Ä´·ÄÄ·Ä∫·ÄÅ·Äª·ÄΩ·Äê·Ä∫/·Ä°·Äõ·Ää·Ä∫·Äê·ÄΩ·ÄÄ·Ä∫</span></a>
            <a onclick="showView('diamond-calc')">üíé <span style="margin-left:5px">·ÄÖ·Ä≠·Äî·Ä∫·Äî·Äæ·ÄÑ·Ä∑·Ä∫ ·Äõ·Äê·Äî·Ä¨·Äê·ÄΩ·ÄÄ·Ä∫·Äõ·Äî·Ä∫</span></a>
            <a onclick="showView('unit-converter')">üîÑ <span style="margin-left:5px">·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äõ·Äî·Ä∫</span></a>
            <a onclick="showView('net-weight')">üìâ <span style="margin-left:5px">·Ä°·Äû·Ä¨·Ä∏·Äê·ÄÑ·Ä∫·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫</span></a>
            <a onclick="resetAllData()" style="color: #ff4444; border-top: 1px solid var(--card-border); margin-top: 20px;">‚ö†Ô∏è <span>·Äí·Ä±·Äê·Ä¨·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·Äñ·Äª·ÄÄ·Ä∫·Äô·Ää·Ä∫</span></a>
        </div>
        <div id="overlay" class="overlay" onclick="closeNav()"></div>

        <header>
            <div class="header-left" style="display:flex; align-items:center;">
                <span style="font-size:1.5rem; cursor:pointer; color:var(--gold-primary); margin-right:20px;" onclick="openNav()">&#9776;</span>
                <span id="nav-title">SHWE CALCULATOR PRO</span>
            </div>
            <div class="theme-toggle" onclick="toggleTheme()" id="theme-icon">üåô</div>
        </header>

        <div class="container">
            <div id="price-calc-view">
                <h2>Market Price</h2>
                <div class="card">
                    <label>·Äö·Äî·Ä±·Ä∑·Äï·Ä±·Ä´·ÄÄ·Ä∫·Äà·Ä±·Ä∏ (·ÄÄ·Äª·Äï·Ä∫)</label>
                    <input type="number" id="GoldPrice" inputmode="numeric" placeholder="0">
                </div>
                <h2>Weight</h2>
                <div class="card grid-3">
                    <div class="input-group"><label>·ÄÄ·Äª·Äï·Ä∫</label><input type="number" id="PKat" inputmode="numeric"></div>
                    <div class="input-group"><label>·Äï·Ä≤</label><input type="number" id="PPe" inputmode="numeric"></div>
                    <div class="input-group"><label>·Äõ·ÄΩ·Ä±·Ä∏</label><input type="number" id="PYway" inputmode="decimal"></div>
                </div>
                <h2>Wastage / ·Ä°·Äú·Äª·Ä±·Ä¨·Ä∑·Äê·ÄΩ·ÄÄ·Ä∫</h2>
                <div class="card grid-3">
                    <div class="input-group"><label>·ÄÄ·Äª·Äï·Ä∫</label><input type="number" id="RKat" inputmode="numeric"></div>
                    <div class="input-group"><label>·Äï·Ä≤</label><input type="number" id="RPae" inputmode="numeric"></div>
                    <div class="input-group"><label>·Äõ·ÄΩ·Ä±·Ä∏</label><input type="number" id="RYway" inputmode="decimal"></div>
                </div>
                <h2>Services</h2>
                <div class="card">
                    <label>·Äú·ÄÄ·Ä∫·ÄÅ (·ÄÄ·Äª·Äï·Ä∫)</label>
                    <input type="number" id="Smith" inputmode="numeric" style="margin-bottom:15px;">
                    <label>·ÄÄ·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äñ·Ä≠·ÄØ·Ä∏ (·ÄÄ·Äª·Äï·Ä∫)</label>
                    <input type="number" id="StonePrice" inputmode="numeric">
                </div>
                <button class="btn-main" onclick="calculatePrice()">Calculate Total</button>
                <button class="btn-reset" onclick="resetCalculator()">Reset Fields</button>
            </div>

            <div id="purity-calc-view" class="hidden">
                <h2>Purity Master</h2>
                <div class="tab-container">
                    <button id="tab-purity" class="tab active" onclick="switchPurityTab('purity')">·Ä°·Äõ·Ää·Ä∫·Ä°·Äû·ÄΩ·Ä±·Ä∏</button>
                    <button id="tab-yield" class="tab" onclick="switchPurityTab('yield')">·Ä°·Äû·Ä¨·Ä∏·Äê·ÄÑ·Ä∫·Äë·ÄΩ·ÄÄ·Ä∫·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏</button>
                </div>

                <div id="purity-sub-view">
                    <div class="card">
                        <label>·Ä°·Äë·Ää·Ä∫·Äï·Äª·ÄÄ·Ä∫ ·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫</label>
                        <div class="grid-3">
                            <div class="input-group"><label>·ÄÄ·Äª·Äï·Ä∫</label><input type="number" id="p1-k"></div>
                            <div class="input-group"><label>·Äï·Ä≤</label><input type="number" id="p1-p"></div>
                            <div class="input-group"><label>·Äõ·ÄΩ·Ä±·Ä∏</label><input type="number" id="p1-y"></div>
                        </div>
                    </div>
                    <div class="card">
                        <label>·ÄÅ·Äª·ÄΩ·Äê·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äõ·Äõ·Äæ·Ä≠·Äû·Ä±·Ä¨ ·Ä°·ÄÅ·Ä±·Ä´·ÄÄ·Ä∫·Äõ·ÄΩ·Äæ·Ä±</label>
                        <div class="grid-3">
                            <div class="input-group"><label>·ÄÄ·Äª·Äï·Ä∫</label><input type="number" id="p2-k"></div>
                            <div class="input-group"><label>·Äï·Ä≤</label><input type="number" id="p2-p"></div>
                            <div class="input-group"><label>·Äõ·ÄΩ·Ä±·Ä∏</label><input type="number" id="p2-y"></div>
                        </div>
                    </div>
                    <button class="btn-main" onclick="calcPurity()">Check Purity</button>
                </div>

                <div id="yield-sub-view" class="hidden">
                    <div class="card">
                        <label>·Ä°·Äë·Ää·Ä∫·Äï·Äª·ÄÄ·Ä∫ ·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫</label>
                        <div class="grid-3">
                            <div class="input-group"><label>·ÄÄ·Äª·Äï·Ä∫</label><input type="number" id="y1-k"></div>
                            <div class="input-group"><label>·Äï·Ä≤</label><input type="number" id="y1-p"></div>
                            <div class="input-group"><label>·Äõ·ÄΩ·Ä±·Ä∏</label><input type="number" id="y1-y"></div>
                        </div>
                    </div>
                    <div class="card">
                        <label>Density / ·ÄÖ·ÄÄ·Ä∫·Äï·ÄΩ·Ä≠·ÄØ·ÄÑ·Ä∑·Ä∫</label>
                        <input type="number" id="y-den" placeholder="17.51" step="0.01">
                        <p style="text-align: center; margin: 15px 0; color:var(--text-dim); font-size: 0.8rem;">OR</p>
                        <label>·Äï·Ä≤·Äõ·Ää·Ä∫</label>
                        <input type="number" id="y-pe" placeholder="15">
                    </div>
                    <button class="btn-main" onclick="calcYield()">Calculate Yield</button>
                </div>

                <div id="purity-result" class="highlight-box hidden" style="margin-top:20px;">
                    <label id="p-res-label">Result</label>
                    <div id="p-res-val" class="main-ans">0.00</div>
                    <div id="p-res-detail" style="font-size:0.9rem; color:var(--text-dim)">-</div>
                </div>
            </div>

            <div id="diamond-calc-view" class="hidden">
                <h2 style="color: #b9f2ff">Diamond Pricing</h2>
                <div class="card">
                    <label>·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫</label>
                    <select id="DiamondPriceType" style="margin-bottom:15px;" onchange="updateEquivPrice()">
                        <option value="carat">Per Carat (·ÅÅ ·ÄÄ·Ä¨·Äõ·ÄÄ·Ä∫·Äà·Ä±·Ä∏)</option>
                        <option value="ratti">Per Ratti (·ÅÅ ·Äõ·Äê·ÄÆ·Äà·Ä±·Ä∏)</option>
                    </select>
                    <label>·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏ (·ÄÄ·Äª·Äï·Ä∫)</label>
                    <input type="number" id="DiamondPrice" placeholder="0" oninput="updateEquivPrice()">
                    <div id="equivPriceDisplay" style="font-size: 0.8rem; color: #80deea; margin-top: 10px; font-style: italic;"></div>
                </div>

                <h2 style="color: #b9f2ff">Carat Weight</h2>
                <div class="card">
                    <label>·ÄÄ·Ä¨·Äõ·ÄÄ·Ä∫ (Carat)</label>
                    <input type="number" id="DCt" step="0.01" placeholder="0.00" oninput="syncDiamondUnits('ct')">
                    <div style="margin: 20px 0; border-top: 1px solid var(--card-border); padding-top:20px;">
                        <label>·Äõ·Äê·ÄÆ / ·Äó·Äº·ÄÆ / ·Äï·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏</label>
                        <div class="grid-3">
                            <div class="input-group"><label>·Äõ·Äê·ÄÆ</label><input type="number" id="DR" oninput="syncDiamondUnits('unit')"></div>
                            <div class="input-group"><label>·Äó·Äº·ÄÆ</label><input type="number" id="DB" oninput="syncDiamondUnits('unit')"></div>
                            <div class="input-group"><label>·Äï·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏</label><input type="number" id="DP" oninput="syncDiamondUnits('unit')"></div>
                        </div>
                    </div>
                </div>

                <button class="btn-main btn-diamond" onclick="calculateDiamondPrice()">Calculate Diamond</button>
                <button class="btn-reset" onclick="resetDiamond()">Reset</button>
            </div>

            <div id="unit-converter-view" class="hidden">
                <h2>Unit Converter</h2>
                <div class="card">
                    <label>Grams (·ÄÇ·Äõ·Äô·Ä∫)</label>
                    <input type="number" id="gramsInput" placeholder="0.000">
                    <div class="grid-3" style="margin:20px 0;">
                        <div class="input-group"><label>·ÄÄ·Äª·Äï·Ä∫</label><input type="number" id="uKyat"></div>
                        <div class="input-group"><label>·Äï·Ä≤</label><input type="number" id="uPe"></div>
                        <div class="input-group"><label>·Äõ·ÄΩ·Ä±·Ä∏</label><input type="number" id="uYway"></div>
                    </div>
                    <select id="standard" onchange="convertUnits('grams')">
                        <option value="16.329325">Official Gold (16.329g)</option>
                        <option value="16.606">Traditional (16.606g)</option>
                    </select>
                </div>
                
                <div class="highlight-box">
                    <label>Converted Weight</label>
                    <div id="uDisplay" class="main-ans">·ÅÄ ·ÄÄ·Äª·Äï·Ä∫ ·ÅÄ ·Äï·Ä≤ ·ÅÄ ·Äõ·ÄΩ·Ä±·Ä∏</div>
                    <div id="uSubDisplay" style="color:var(--text-dim); font-size:0.9rem;">(0.0000 ·ÄÄ·Äª·Äï·Ä∫)</div>
                </div>
                <button class="btn-reset" onclick="resetConverter()">Reset</button>
            </div>

            <div id="net-weight-view" class="hidden">
                <h2>Net Calculation</h2>
                <div class="card">
                    <label>Total Weight (·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏)</label>
                    <div class="grid-3">
                        <input type="number" id="TKat" placeholder="K" oninput="calculateNetWeight()">
                        <input type="number" id="TPe" placeholder="P" oninput="calculateNetWeight()">
                        <input type="number" id="TYway" placeholder="Y" oninput="calculateNetWeight()">
                    </div>
                </div>
                <div class="card">
                    <label>Subtract Stone (·ÄÄ·Äª·Ä±·Ä¨·ÄÄ·Ä∫·Äñ·Ä≠·ÄØ·Ä∏·Äî·Äæ·ÄØ·Äê·Ä∫)</label>
                    <div class="grid-3">
                        <input type="number" id="SKat" placeholder="K" oninput="calculateNetWeight()">
                        <input type="number" id="SPe" placeholder="P" oninput="calculateNetWeight()">
                        <input type="number" id="SYway" placeholder="Y" oninput="calculateNetWeight()">
                    </div>
                </div>
                <div class="highlight-box">
                    <label>Net Gold Weight</label>
                    <div id="netDisplay" class="main-ans">·ÅÄ ·ÄÄ·Äª·Äï·Ä∫ ·ÅÄ ·Äï·Ä≤ ·ÅÄ ·Äõ·ÄΩ·Ä±·Ä∏</div>
                    <div id="netSubDisplay" style="color:var(--text-dim); font-size:0.9rem;">(0.0000 ·ÄÄ·Äª·Äï·Ä∫)</div>
                </div>
                <button class="btn-reset" onclick="resetNetWeight()">Reset</button>
            </div>

            <div id="price-result-view" class="hidden">
                <div id="capture-area" class="card" style="background: #0a0b0d; border: 2px solid var(--gold-primary);">
                    <h2 id="res-title" style="text-align:center; border:none; color:var(--gold-primary); justify-content:center;">Summary</h2>
                    <div id="res-list" style="margin-top:20px;"></div>
                </div>
                <button class="btn-main" style="background: #28a745; color: white; margin-top:10px;" onclick="saveAsPhoto()">üì∑ Save to Gallery</button>
                <button id="res-back-btn" class="btn-reset" style="color:var(--text); border-color:var(--card-border)" onclick="showView('price-calc')">Back</button>
            </div>
        </div>
    </div>

    <script>
        // Theme Toggle Logic
        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            const meta = document.getElementById('theme-meta');
            if (body.getAttribute('data-theme') === 'dark') {
                body.setAttribute('data-theme', 'light');
                icon.innerText = "‚òÄÔ∏è";
                meta.setAttribute('content', '#ffffff');
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                icon.innerText = "üåô";
                meta.setAttribute('content', '#1a1a1a');
                localStorage.setItem('theme', 'dark');
            }
        }

        // Keep all your existing functions exactly as they were
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('input', () => { if(input.id) localStorage.setItem(input.id, input.value); });
        });

        window.onload = () => {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').innerText = (savedTheme === 'dark') ? "üåô" : "‚òÄÔ∏è";
            inputs.forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue && input.id) input.value = savedValue;
            });
            calculateNetWeight();
            updateEquivPrice();
        };

        function openNav() { document.getElementById("mySidebar").style.width = "280px"; document.getElementById("overlay").style.display = "block"; }
        function closeNav() { document.getElementById("mySidebar").style.width = "0"; document.getElementById("overlay").style.display = "none"; }

        function showView(view) {
            ['price-calc-view', 'diamond-calc-view', 'unit-converter-view', 'net-weight-view', 'price-result-view', 'purity-calc-view'].forEach(v => {
                const el = document.getElementById(v);
                if(el) el.classList.add('hidden');
            });
            const target = document.getElementById(view + '-view');
            if(target) target.classList.remove('hidden');
            
            const title = document.getElementById('nav-title');
            if(view === 'diamond-calc') {
                title.innerText = "DIAMOND CALCULATOR";
                title.style.background = "var(--diamond-gradient)";
                title.style.webkitBackgroundClip = "text";
            } else {
                title.innerText = "SHWE CALCULATOR PRO";
                title.style.background = "var(--gold-gradient)";
                title.style.webkitBackgroundClip = "text";
            }
            closeNav();
            window.scrollTo(0,0);
        }

        function switchPurityTab(type) {
            document.getElementById('tab-purity').classList.toggle('active', type === 'purity');
            document.getElementById('tab-yield').classList.toggle('active', type === 'yield');
            document.getElementById('purity-sub-view').classList.toggle('hidden', type !== 'purity');
            document.getElementById('yield-sub-view').classList.toggle('hidden', type !== 'yield');
            document.getElementById('purity-result').classList.add('hidden');
        }

        function toDecimal(k, p, y) { return (parseFloat(k)||0) + ((parseFloat(p)||0)/16) + ((parseFloat(y)||0)/128); }

        function fromDecimal(decimal) {
            let k = Math.floor(decimal + 0.0000001);
            let remPe = (decimal - k) * 16;
            let p = Math.floor(remPe + 0.0000001);
            let y = parseFloat(((remPe - p) * 8).toFixed(2));
            if(y >= 8) { p++; y = 0; }
            if(p >= 16) { k++; p = 0; }
            return `${k} ·ÄÄ·Äª·Äï·Ä∫ ${p} ·Äï·Ä≤ ${y} ·Äõ·ÄΩ·Ä±·Ä∏`;
        }

        function calcPurity() {
            let raw = toDecimal(document.getElementById('p1-k').value, document.getElementById('p1-p').value, document.getElementById('p1-y').value);
            let pure = toDecimal(document.getElementById('p2-k').value, document.getElementById('p2-p').value, document.getElementById('p2-y').value);
            if(raw <= 0 || pure <= 0) return alert("·Ä°·Äú·Ä±·Ä∏·ÄÅ·Äª·Ä≠·Äî·Ä∫·Äô·Äæ·Äî·Ä∫·ÄÄ·Äî·Ä∫·ÄÖ·ÄΩ·Ä¨·Äë·Ää·Ä∑·Ä∫·Äï·Ä´·Åã");
            let peYee = (pure / raw) * 16;
            let density = (pure / raw) * 19.32;
            document.getElementById('purity-result').classList.remove('hidden');
            document.getElementById('p-res-label').innerText = "·Äê·ÄΩ·ÄÄ·Ä∫·ÄÅ·Äª·ÄÄ·Ä∫·Äõ·Äõ·Äæ·Ä≠·Äû·Ä±·Ä¨ ·Äõ·ÄΩ·Äæ·Ä±·Ä°·Äõ·Ää·Ä∫·Ä°·Äû·ÄΩ·Ä±·Ä∏";
            document.getElementById('p-res-val').innerText = `${peYee.toFixed(2)} ·Äï·Ä≤·Äõ·Ää·Ä∫`;
            document.getElementById('p-res-detail').innerText = `Density (·ÄÖ·ÄÄ·Ä∫·Äï·ÄΩ·Ä≠·ÄØ·ÄÑ·Ä∑·Ä∫): ${density.toFixed(2)}`;
        }

        function calcYield() {
            let raw = toDecimal(document.getElementById('y1-k').value, document.getElementById('y1-p').value, document.getElementById('y1-y').value);
            let den = parseFloat(document.getElementById('y-den').value);
            let pe = parseFloat(document.getElementById('y-pe').value);
            let resultKyat = 0;
            if(den > 0) resultKyat = (den / 19.32) * raw;
            else if(pe > 0) resultKyat = (pe / 16) * raw;
            else return alert("Density (·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫) ·Äï·Ä≤·Äõ·Ää·Ä∫ ·Äê·ÄÖ·Ä∫·ÄÅ·ÄØ·ÄÅ·ÄØ·Äë·Ää·Ä∑·Ä∫·Äï·Ä´·Åã");
            document.getElementById('purity-result').classList.remove('hidden');
            document.getElementById('p-res-label').innerText = "·Äï·Äº·Äî·Ä∫·Äõ·Äô·Ää·Ä∑·Ä∫ ·Ä°·ÄÅ·Ä±·Ä´·ÄÄ·Ä∫·Äõ·ÄΩ·Äæ·Ä±·Äï·Äô·Ä¨·Äè";
            document.getElementById('p-res-val').innerText = fromDecimal(resultKyat);
            document.getElementById('p-res-detail').innerText = `·ÄÖ·ÄØ·ÄÖ·ÄØ·Äï·Ä±·Ä´·ÄÑ·Ä∫·Ä∏·Äí·Äû·Äô·ÄÄ·Ä≠·Äî·Ä∫·Ä∏: ${resultKyat.toFixed(6)} ·ÄÄ·Äª·Äï·Ä∫`;
        }

        function updateEquivPrice() {
            const price = parseFloat(document.getElementById('DiamondPrice').value) || 0;
            const type = document.getElementById('DiamondPriceType').value;
            const display = document.getElementById('equivPriceDisplay');
            if (price === 0) { display.innerText = ""; return; }
            if (type === 'carat') display.innerText = `‚âà ${Math.round(price / 1.1).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫ (·ÅÅ ·Äõ·Äê·ÄÆ·Äú·Äª·Äæ·ÄÑ·Ä∫)`;
            else display.innerText = `‚âà ${Math.round(price * 1.1).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫ (·ÅÅ ·ÄÄ·Ä¨·Äõ·ÄÄ·Ä∫·Äú·Äª·Äæ·ÄÑ·Ä∫)`;
        }

        function syncDiamondUnits(mode) {
            let dr = document.getElementById('DR'), db = document.getElementById('DB'), dp = document.getElementById('DP'), dct = document.getElementById('DCt');
            if (mode === 'ct') {
                const ct = parseFloat(dct.value) || 0;
                const totalRatti = ct * 1.1;
                const r = Math.floor(totalRatti + 0.00001);
                const remB = (totalRatti - r) * 20;
                const b = Math.floor(remB + 0.00001);
                const p = parseFloat(((remB - b) * 8).toFixed(2));
                dr.value = r || ""; db.value = b || ""; dp.value = p > 0 ? p : "";
            } else {
                let r = parseFloat(dr.value) || 0, b = parseFloat(db.value) || 0, p = parseFloat(dp.value) || 0;
                if (p >= 8) { b += Math.floor(p / 8); p = parseFloat((p % 8).toFixed(2)); db.value = b; dp.value = p > 0 ? p : ""; }
                if (b >= 20) { r += Math.floor(b / 20); b = b % 20; dr.value = r; db.value = b > 0 ? b : ""; }
                const totalRatti = r + (b / 20) + (p / 160);
                dct.value = (totalRatti / 1.1).toFixed(4);
            }
        }

        function calculateDiamondPrice() {
            const price = parseFloat(document.getElementById('DiamondPrice').value) || 0;
            const type = document.getElementById('DiamondPriceType').value;
            const ct = parseFloat(document.getElementById('DCt').value) || 0;
            const r = parseFloat(document.getElementById('DR').value) || 0;
            const b = parseFloat(document.getElementById('DB').value) || 0;
            const p = parseFloat(document.getElementById('DP').value) || 0;
            const totalRatti = r + (b / 20) + (p / 160);
            let total = (type === 'carat') ? (ct * price) : (totalRatti * price);
            document.getElementById('res-title').innerText = "Diamond Summary";
            document.getElementById('res-title').style.color = "#b9f2ff";
            document.getElementById('res-back-btn').onclick = () => showView('diamond-calc');
            document.getElementById('res-list').innerHTML = `
                <div class="res-row" style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05)"><span>Rate</span><span style="color:#b9f2ff">${price.toLocaleString()}</span></div>
                <div class="res-row" style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05)"><span>Weight (Ct)</span><span>${ct} Carat</span></div>
                <div class="res-row" style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05)"><span>Unit (R/B/P)</span><span>${r}R ${b}B ${p}P</span></div>
                <div class="total-row" style="text-align:center; color:#b9f2ff">
                    <span style="display:block; font-size:0.8rem; text-transform:uppercase">Total Amount</span>
                    <span style="font-size:1.8rem; font-weight:800">${Math.round(total).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫</span>
                </div>
            `;
            showView('price-result');
        }

        function calculatePrice() {
            const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;
            const price = getVal('GoldPrice');
            const pk = getVal('PKat'), pp = getVal('PPe'), py = getVal('PYway');
            const rk = getVal('RKat'), rp = getVal('RPae'), ry = getVal('RYway');
            const goldKyat = toDecimal(pk, pp, py);
            const redKyat = toDecimal(rk, rp, ry);
            const smith = getVal('Smith'), stone = getVal('StonePrice');
            const total = (goldKyat * price) + (redKyat * price) + smith + stone;

            document.getElementById('res-title').innerText = "Gold Calculation";
            document.getElementById('res-title').style.color = "var(--gold-primary)";
            document.getElementById('res-back-btn').onclick = () => showView('price-calc');
            document.getElementById('res-list').innerHTML = `
                <div class="res-row" style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05)"><span>Price/Kyat</span><span style="color:var(--gold-primary)">${price.toLocaleString()}</span></div>
                <div class="res-row" style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05)"><span>Gold Value</span><span>${Math.round(goldKyat * price).toLocaleString()}</span></div>
                <div class="res-row" style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05)"><span>Wastage</span><span>${Math.round(redKyat * price).toLocaleString()}</span></div>
                <div class="res-row" style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.05)"><span>Services</span><span>${(smith + stone).toLocaleString()}</span></div>
                <div class="total-row" style="text-align:center;">
                    <span style="display:block; font-size:0.8rem; text-transform:uppercase; color:var(--text-dim)">Grand Total</span>
                    <span style="font-size:1.8rem; font-weight:800; color:var(--gold-primary)">${Math.round(total).toLocaleString()} ·ÄÄ·Äª·Äï·Ä∫</span>
                </div>
            `;
            showView('price-result');
        }

        function calculateNetWeight() {
            const tk = parseFloat(document.getElementById('TKat').value) || 0, tp = parseFloat(document.getElementById('TPe').value) || 0, ty = parseFloat(document.getElementById('TYway').value) || 0;
            const sk = parseFloat(document.getElementById('SKat').value) || 0, sp = parseFloat(document.getElementById('SPe').value) || 0, sy = parseFloat(document.getElementById('SYway').value) || 0;
            const netDec = Math.max(0, toDecimal(tk, tp, ty) - toDecimal(sk, sp, sy));
            document.getElementById('netDisplay').innerText = fromDecimal(netDec);
            document.getElementById('netSubDisplay').innerText = `(${netDec.toFixed(4)} ·ÄÄ·Äª·Äï·Ä∫)`;
        }

        function convertUnits(source) {
            const factor = parseFloat(document.getElementById('standard').value);
            let kyatDec = (source === 'grams') ? (parseFloat(document.getElementById('gramsInput').value) || 0) / factor : toDecimal(document.getElementById('uKyat').value, document.getElementById('uPe').value, document.getElementById('uYway').value);
            document.getElementById('uDisplay').innerText = fromDecimal(kyatDec);
            document.getElementById('uSubDisplay').innerText = `(${kyatDec.toFixed(4)} ·ÄÄ·Äª·Äï·Ä∫) | ${(kyatDec * factor).toFixed(3)} g`;
            if (source === 'grams') {
                let parts = fromDecimal(kyatDec).match(/\d+(\.\d+)?/g);
                document.getElementById('uKyat').value = parts[0]; document.getElementById('uPe').value = parts[1]; document.getElementById('uYway').value = parts[2];
            } else document.getElementById('gramsInput').value = (kyatDec * factor).toFixed(3);
        }

        function resetAllData() {
            if (confirm("·Äí·Ä±·Äê·Ä¨·Ä°·Ä¨·Ä∏·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ ·Äñ·Äª·ÄÄ·Ä∫·Äï·ÄÖ·Ä∫·Äõ·Äî·Ä∫ ·Äû·Ä±·ÄÅ·Äª·Ä¨·Äï·Ä´·Äû·Äú·Ä¨·Ä∏?")) {
                document.querySelectorAll('input').forEach(i => i.value = "");
                localStorage.clear();
                location.reload();
            }
        }

        function resetCalculator() { document.querySelectorAll('#price-calc-view input').forEach(i => { i.value = ""; localStorage.removeItem(i.id); }); }
        function resetDiamond() { document.querySelectorAll('#diamond-calc-view input').forEach(i => { i.value = ""; localStorage.removeItem(i.id); }); updateEquivPrice(); }
        function resetConverter() { document.querySelectorAll('#unit-converter-view input').forEach(i => { i.value = ""; localStorage.removeItem(i.id); }); document.getElementById('uDisplay').innerText="·ÅÄ ·ÄÄ·Äª·Äï·Ä∫ ·ÅÄ ·Äï·Ä≤ ·ÅÄ ·Äõ·ÄΩ·Ä±·Ä∏"; }
        function resetNetWeight() { ['TKat','TPe','TYway','SKat','SPe','SYway'].forEach(id => { document.getElementById(id).value = ""; localStorage.removeItem(id); }); calculateNetWeight(); }
        
        document.getElementById('gramsInput').addEventListener('input', () => convertUnits('grams'));
        ['uKyat', 'uPe', 'uYway'].forEach(id => document.getElementById(id).addEventListener('input', () => convertUnits('units')));
        
        function saveAsPhoto() {
            html2canvas(document.getElementById("capture-area"), { 
                backgroundColor: "#0a0b0d", 
                scale: 3,
                useCORS: true 
            }).then(canvas => {
                const link = document.createElement('a'); 
                link.download = `ShweCalc_${Date.now()}.png`; 
                link.href = canvas.toDataURL("image/png"); 
                link.click();
            });
        }
    </script>
</body>
</html>
