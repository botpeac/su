<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" id="theme-meta" content="#fcc103">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Shwe Calculator Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>

    <style>
        :root {
            --gold: #fcc103;
            --diamond: #b9f2ff;
            --bg: #000000;
            --card: #1e1e1e;
            --input-bg: #2a2a2a;
            --text: #ffffff;
            --label-text: #cccccc;
            --border: #444;
            /* SAFE AREA CONSTANTS */
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            --safe-left: env(safe-area-inset-left);
            --safe-right: env(safe-area-inset-right);
        }

        [data-theme="light"] {
            --bg: #f4f4f9;
            --card: #ffffff;
            --input-bg: #f9f9f9;
            --text: #1a1a1a;
            --label-text: #555555;
            --border: #dddddd;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 0; overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
            /* Prevents content from being hidden behind side notches in landscape */
            padding-left: var(--safe-left);
            padding-right: var(--safe-right);
        }

        .app-wrapper { display: flex; flex-direction: column; min-height: 100vh; }

        header {
            background: var(--card);
            /* Padding adjustment for Status Bar / Dynamic Island */
            padding: calc(15px + var(--safe-top)) 15px 15px 15px;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 2px solid var(--gold);
            position: sticky; top: 0; z-index: 900;
        }

        .header-left { display: flex; align-items: center; }

        .container {
            padding: 20px; max-width: 450px; margin: auto; width: 100%; box-sizing: border-box;
            /* Padding adjustment for Home Bar (Bottom Indicator) */
            padding-bottom: calc(100px + var(--safe-bottom));
        }

        .card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid var(--border); margin-bottom: 20px; }
        h2 { color: var(--gold); font-size: 1.3rem; margin-top: 0; border-left: 5px solid var(--gold); padding-left: 12px; font-weight: bold; }
        .h2-diamond { color: var(--diamond); border-left-color: var(--diamond); }
        label { display: block; font-size: 1.1rem; color: var(--label-text); margin-bottom: 8px; font-weight: bold; }

        input, select {
            width: 100%; padding: 16px; background: var(--input-bg);
            border: 2px solid var(--border); border-radius: 12px; color: var(--text);
            box-sizing: border-box; outline: none; font-size: 20px;
        }

        input:focus { border-color: var(--gold); }
        .diamond-focus:focus { border-color: var(--diamond); }
        
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        
        .btn-main { width: 100%; padding: 20px; background: var(--gold); color: #000; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 20px; font-size: 1.4rem; }
        .btn-diamond { background: var(--diamond); }
        .btn-reset { width: 100%; padding: 15px; background: transparent; color: #ff6666; border: 2px solid #ff6666; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 15px; font-size: 1.1rem; }

        .tab-container { display: flex; margin-bottom: 20px; gap: 10px; }
        .tab { flex: 1; padding: 12px; border: 2px solid var(--border); background: var(--input-bg); color: var(--text); cursor: pointer; border-radius: 10px; font-weight: bold; transition: 0.3s; }
        .tab.active { background: var(--gold); color: #000; border-color: var(--gold); }

        .sidebar { height: 100%; width: 0; position: fixed; z-index: 1000; top: 0; left: 0; background-color: var(--card); overflow-x: hidden; transition: 0.3s; padding-top: calc(60px + var(--safe-top)); }
        .sidebar a { padding: 15px 25px; text-decoration: none; font-size: 1.3rem; color: var(--text); display: block; border-bottom: 1px solid var(--border); }
        .overlay { display: none; position: fixed; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 999; top:0; left:0; }
        .hidden { display: none; }
        
        .highlight-box { background: rgba(252, 193, 3, 0.1); border: 2px solid var(--gold); padding: 20px; border-radius: 15px; text-align: center; margin-top: 10px; }
        .res-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); font-size: 1.2rem; }
        .val-highlight { color: var(--gold); font-weight: bold; }
        .total-row { color: var(--gold); font-weight: bold; font-size: 1.8rem; margin-top: 15px; background: rgba(252, 193, 3, 0.15); padding: 15px; border-radius: 10px; text-align: center; }
        .main-ans { font-size: 2rem; font-weight: bold; color: var(--gold); line-height: 1.2; }
        .theme-toggle { font-size: 1.5rem; cursor: pointer; color: var(--gold); padding: 5px 10px; border-radius: 8px; background: var(--input-bg); }
        
        .btn-master-reset { color: #ff4444 !important; font-weight: bold; border-top: 2px solid var(--border); margin-top: 20px; }

        .ref-box { border: 1px dashed var(--gold); padding: 15px; border-radius: 10px; margin-bottom: 20px; background: rgba(252, 193, 3, 0.05); }
        .ref-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; font-size: 0.95rem; }
    </style>
</head>
<body data-theme="dark">

    <div class="app-wrapper">
        <div id="mySidebar" class="sidebar">
            <a href="javascript:void(0)" style="position:absolute; top: calc(10px + var(--safe-top)); right:25px; font-size:35px;" onclick="closeNav()">&times;</a>
            <div style="padding: 20px 25px;"><h3 style="color:var(--gold); margin:0;">á€›á€½á€¾á€±á€á€½á€€á€ºá€…á€€á€º</h3></div>
            <a onclick="showView('price-calc')">ğŸ’° á€›á€½á€¾á€±á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€á€½á€€á€ºá€›á€”á€º</a>
            <a onclick="showView('purity-calc')">âš–ï¸ á€¡á€á€±á€«á€€á€ºá€á€»á€½á€á€º/á€¡á€›á€Šá€ºá€á€½á€€á€º</a>
            <a onclick="showView('diamond-calc')">ğŸ’ á€…á€­á€”á€ºá€”á€¾á€„á€·á€º á€›á€á€”á€¬á€á€½á€€á€ºá€›á€”á€º</a>
            <a onclick="showView('unit-converter')">âš–ï¸ á€¡á€œá€±á€¸á€á€»á€­á€”á€ºá€•á€¼á€±á€¬á€„á€ºá€¸á€›á€”á€º</a>
            <a onclick="showView('net-weight')">âš–ï¸ á€¡á€á€¬á€¸á€á€„á€ºá€¡á€œá€±á€¸á€á€»á€­á€”á€º</a>
            <a onclick="resetAllData()" class="btn-master-reset">âš ï¸ á€’á€±á€á€¬á€¡á€¬á€¸á€œá€¯á€¶á€¸á€–á€»á€€á€ºá€™á€Šá€º</a>
        </div>
        <div id="overlay" class="overlay" onclick="closeNav()"></div>

        <header>
            <div class="header-left">
                <span style="font-size:1.8rem; cursor:pointer; color:var(--gold); margin-right:15px;" onclick="openNav()">&#9776;</span>
                <span id="nav-title" style="font-weight:bold; font-size: 1.1rem; letter-spacing: 0.5px;">SHWE CALCULATOR PRO</span>
            </div>
            <div class="theme-toggle" onclick="toggleTheme()" id="theme-icon">ğŸŒ™</div>
        </header>

        <div class="container">
            <div id="price-calc-view">
                <h2>á€›á€½á€¾á€±á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸</h2>
                <div class="card">
                    <label>á€šá€”á€±á€·á€•á€±á€«á€€á€ºá€ˆá€±á€¸ (á€€á€»á€•á€º)</label>
                    <input type="number" id="GoldPrice" inputmode="numeric" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€‘á€Šá€·á€ºá€•á€«...">
                </div>
                <h2>á€›á€½á€¾á€±á€¡á€œá€±á€¸á€á€»á€­á€”á€º</h2>
                <div class="card grid-3">
                    <div class="input-group"><label>á€€á€»á€•á€º</label><input type="number" id="PKat" inputmode="numeric"></div>
                    <div class="input-group"><label>á€•á€²</label><input type="number" id="PPe" inputmode="numeric"></div>
                    <div class="input-group"><label>á€›á€½á€±á€¸</label><input type="number" id="PYway" inputmode="decimal"></div>
                </div>
                <h2>á€¡á€œá€»á€±á€¬á€·á€á€½á€€á€º</h2>
                <div class="card grid-3">
                    <div class="input-group"><label>á€€á€»á€•á€º</label><input type="number" id="RKat" inputmode="numeric"></div>
                    <div class="input-group"><label>á€•á€²</label><input type="number" id="RPae" inputmode="numeric"></div>
                    <div class="input-group"><label>á€›á€½á€±á€¸</label><input type="number" id="RYway" inputmode="decimal"></div>
                </div>
                <h2>á€œá€€á€ºá€ á€”á€¾á€„á€ºá€· á€€á€»á€±á€¬á€€á€ºá€–á€­á€¯á€¸</h2>
                <div class="card">
                    <label>á€œá€€á€ºá€ (á€€á€»á€•á€º)</label>
                    <input type="number" id="Smith" inputmode="numeric" style="margin-bottom:15px;">
                    <label>á€€á€»á€±á€¬á€€á€ºá€–á€­á€¯á€¸ (á€€á€»á€•á€º)</label>
                    <input type="number" id="StonePrice" inputmode="numeric">
                </div>
                <button class="btn-main" onclick="calculatePrice()">á€á€½á€€á€ºá€á€»á€€á€ºá€™á€Šá€º</button>
                <button class="btn-reset" onclick="resetCalculator()">á€¡á€€á€¯á€”á€ºá€–á€»á€€á€ºá€™á€Šá€º (RESET)</button>
            </div>

            <div id="purity-calc-view" class="hidden">
                <h2>á€¡á€á€±á€«á€€á€ºá€á€»á€½á€á€ºá€á€½á€€á€ºá€…á€€á€º</h2>
                
                <div class="ref-box">
                    <div style="font-weight: bold; color: var(--gold); text-align: center; margin-bottom: 8px;">Density á€á€á€ºá€™á€¾á€á€ºá€á€»á€€á€º</div>
                    <div class="ref-grid">
                        <div style="border-right: 1px solid var(--border);">áá† á€•á€²á€›á€Šá€º (á€¡á€á€±á€«á€€á€º) <br> <b style="color:var(--gold)">19.25</b></div>
                        <div>áá… á€•á€²á€›á€Šá€º <br> <b style="color:var(--gold)">17.80</b></div>
                    </div>
                </div>

                <div class="tab-container">
                    <button id="tab-purity" class="tab active" onclick="switchPurityTab('purity')">á€¡á€›á€Šá€ºá€¡á€á€½á€±á€¸á€á€½á€€á€º</button>
                    <button id="tab-yield" class="tab" onclick="switchPurityTab('yield')">á€¡á€á€¬á€¸á€á€„á€ºá€‘á€½á€€á€ºá€”á€¾á€¯á€”á€ºá€¸</button>
                </div>

                <div id="purity-sub-view">
                    <div class="card">
                        <label>á€¡á€‘á€Šá€ºá€•á€»á€€á€º á€¡á€œá€±á€¸á€á€»á€­á€”á€º</label>
                        <div class="grid-3">
                            <div class="input-group"><label>á€€á€»á€•á€º</label><input type="number" id="p1-k" inputmode="numeric"></div>
                            <div class="input-group"><label>á€•á€²</label><input type="number" id="p1-p" inputmode="numeric"></div>
                            <div class="input-group"><label>á€›á€½á€±á€¸</label><input type="number" id="p1-y" inputmode="decimal"></div>
                        </div>
                    </div>
                    <div class="card">
                        <label>á€á€»á€½á€á€ºá€•á€¼á€®á€¸á€›á€›á€¾á€­á€á€±á€¬ á€¡á€á€±á€«á€€á€ºá€›á€½á€¾á€±</label>
                        <div class="grid-3">
                            <div class="input-group"><label>á€€á€»á€•á€º</label><input type="number" id="p2-k" inputmode="numeric"></div>
                            <div class="input-group"><label>á€•á€²</label><input type="number" id="p2-p" inputmode="numeric"></div>
                            <div class="input-group"><label>á€›á€½á€±á€¸</label><input type="number" id="p2-y" inputmode="decimal"></div>
                        </div>
                    </div>
                    <button class="btn-main" onclick="calcPurity()">á€á€½á€€á€ºá€™á€Šá€º</button>
                </div>

                <div id="yield-sub-view" class="hidden">
                    <div class="card">
                        <label>á€¡á€‘á€Šá€ºá€•á€»á€€á€º á€¡á€œá€±á€¸á€á€»á€­á€”á€º</label>
                        <div class="grid-3">
                            <div class="input-group"><label>á€€á€»á€•á€º</label><input type="number" id="y1-k" inputmode="numeric"></div>
                            <div class="input-group"><label>á€•á€²</label><input type="number" id="y1-p" inputmode="numeric"></div>
                            <div class="input-group"><label>á€›á€½á€±á€¸</label><input type="number" id="y1-y" inputmode="decimal"></div>
                        </div>
                    </div>
                    <div class="card">
                        <label>Density (á€…á€€á€ºá€•á€½á€­á€¯á€„á€·á€º)</label>
                        <input type="number" id="y-den" placeholder="á€¥á€•á€™á€¬- 17.8" step="0.01" style="margin-bottom:15px;">
                        <p style="text-align: center; margin: 10px 0; font-weight:bold;">- (á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º) -</p>
                        <label>á€•á€²á€›á€Šá€º á€á€­á€œá€»á€¾á€„á€ºá€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«</label>
                        <input type="number" id="y-pe" placeholder="á€¥á€•á€™á€¬- 15">
                    </div>
                    <button class="btn-main" onclick="calcYield()">á€‘á€½á€€á€ºá€”á€¾á€¯á€”á€ºá€¸á€á€½á€€á€ºá€™á€Šá€º</button>
                </div>

                <div id="purity-result" class="highlight-box hidden" style="margin-top:20px;">
                    <label id="p-res-label" style="color:var(--gold);">á€›á€œá€’á€º</label>
                    <div id="p-res-val" class="main-ans">0.00</div>
                    <div id="p-res-detail" style="margin-top:10px; font-size:1.1rem;">-</div>
                </div>
            </div>

            <div id="diamond-calc-view" class="hidden">
                <h2 class="h2-diamond">á€…á€­á€”á€ºá€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸</h2>
                <div class="card">
                    <label>á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€á€á€ºá€™á€¾á€á€ºá€á€»á€€á€º</label>
                    <select id="DiamondPriceType" style="margin-bottom:15px;" onchange="updateEquivPrice()">
                        <option value="carat">á á€€á€¬á€›á€€á€º á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (Per Carat)</option>
                        <option value="ratti">á á€›á€á€® á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (Per Ratti)</option>
                    </select>
                    <label>á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (á€€á€»á€•á€º)</label>
                    <input type="number" id="DiamondPrice" class="diamond-focus" inputmode="numeric" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸á€‘á€Šá€·á€ºá€•á€«..." oninput="updateEquivPrice()">
                    <div id="equivPriceDisplay" style="font-size: 0.95rem; color: var(--diamond); margin-top: 8px; font-style: italic;"></div>
                </div>

                <h2 class="h2-diamond">á€…á€­á€”á€ºá€¡á€œá€±á€¸á€á€»á€­á€”á€º</h2>
                <div class="card">
                    <label>á€€á€¬á€›á€€á€º (Carat)</label>
                    <input type="number" id="DCt" class="diamond-focus" inputmode="decimal" placeholder="0.00" oninput="syncDiamondUnits('ct')">
                    <div style="margin: 15px 0; border-top: 1px solid var(--border); padding-top:15px;">
                        <label>á€›á€á€® / á€—á€¼á€® / á€•á€­á€¯á€„á€ºá€¸ (Auto-Correcting)</label>
                        <div class="grid-3">
                            <div class="input-group"><label>á€›á€á€® (R)</label><input type="number" id="DR" class="diamond-focus" inputmode="decimal" oninput="syncDiamondUnits('unit')"></div>
                            <div class="input-group"><label>á€—á€¼á€® (B)</label><input type="number" id="DB" class="diamond-focus" inputmode="decimal" oninput="syncDiamondUnits('unit')"></div>
                            <div class="input-group"><label>á€•á€­á€¯á€„á€ºá€¸ (P)</label><input type="number" id="DP" class="diamond-focus" inputmode="decimal" oninput="syncDiamondUnits('unit')"></div>
                        </div>
                    </div>
                </div>

                <button class="btn-main btn-diamond" onclick="calculateDiamondPrice()">á€á€½á€€á€ºá€á€»á€€á€ºá€™á€Šá€º</button>
                <button class="btn-reset" onclick="resetDiamond()">RESET</button>
            </div>

            <div id="unit-converter-view" class="hidden">
                <h2>á€šá€°á€”á€…á€º á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€á€¼á€„á€ºá€¸</h2>
                <div class="card">
                    <label>á€‚á€›á€™á€º (Grams)</label>
                    <input type="number" id="gramsInput" inputmode="decimal" placeholder="á€‚á€›á€™á€º á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«...">
                    <div class="grid-3" style="margin:20px 0;">
                        <div class="input-group"><label>á€€á€»á€•á€º</label><input type="number" id="uKyat" inputmode="numeric"></div>
                        <div class="input-group"><label>á€•á€²</label><input type="number" id="uPe" inputmode="numeric"></div>
                        <div class="input-group"><label>á€›á€½á€±á€¸</label><input type="number" id="uYway" inputmode="decimal"></div>
                    </div>
                    <select id="standard" onchange="convertUnits('grams')">
                        <option value="16.329325">á€›á€½á€¾á€±: Official (16.3293g)</option>
                        <option value="16.606">á€›á€½á€¾á€±: Traditional (16.606g)</option>
                    </select>
                </div>
                
                <div class="card" style="border-color: var(--diamond);">
                    <label style="color:var(--diamond);">á€…á€­á€”á€º / á€›á€á€”á€¬ (Carat to Gram)</label>
                    <div class="grid-3">
                        <div style="grid-column: span 2;">
                            <label>á€€á€¬á€›á€€á€º (Ct)</label>
                            <input type="number" id="convCt" inputmode="decimal" oninput="convertDiamondUnits('ct')">
                        </div>
                        <div>
                            <label>á€‚á€›á€™á€º (g)</label>
                            <input type="number" id="convGm" inputmode="decimal" oninput="convertDiamondUnits('gm')">
                        </div>
                    </div>
                </div>

                <div class="highlight-box">
                    <label style="color:var(--gold); text-align:center;">á€›á€½á€¾á€±á€¡á€œá€±á€¸á€á€»á€­á€”á€º á€›á€œá€’á€º</label>
                    <div id="uDisplay" class="main-ans">á€ á€€á€»á€•á€º á€ á€•á€² á€ á€›á€½á€±á€¸</div>
                    <div id="uSubDisplay" style="color:var(--text); font-size:1.1rem; margin-top:10px;">(0.0000 á€€á€»á€•á€º) | 0.000 g</div>
                </div>
                <button class="btn-reset" onclick="resetConverter()">RESET</button>
            </div>

            <div id="net-weight-view" class="hidden">
                <h2>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸á€¡á€œá€±á€¸á€á€»á€­á€”á€º (Total)</h2>
                <div class="card grid-3">
                    <div class="input-group"><label>á€€á€»á€•á€º</label><input type="number" id="TKat" inputmode="numeric" oninput="calculateNetWeight()"></div>
                    <div class="input-group"><label>á€•á€²</label><input type="number" id="TPe" inputmode="numeric" oninput="calculateNetWeight()"></div>
                    <div class="input-group"><label>á€›á€½á€±á€¸</label><input type="number" id="TYway" inputmode="decimal" oninput="calculateNetWeight()"></div>
                </div>
                <h2>á€”á€¾á€¯á€á€ºá€™á€Šá€·á€ºá€¡á€œá€±á€¸á€á€»á€­á€”á€º (Stone)</h2>
                <div class="card grid-3">
                    <div class="input-group"><label>á€€á€»á€•á€º</label><input type="number" id="SKat" inputmode="numeric" oninput="calculateNetWeight()"></div>
                    <div class="input-group"><label>á€•á€²</label><input type="number" id="SPe" inputmode="numeric" oninput="calculateNetWeight()"></div>
                    <div class="input-group"><label>á€›á€½á€±á€¸</label><input type="number" id="SYway" inputmode="decimal" oninput="calculateNetWeight()"></div>
                </div>
                <div class="highlight-box">
                    <label style="color:var(--gold); text-align:center;">á€¡á€á€¬á€¸á€á€„á€ºá€›á€½á€¾á€±á€¡á€œá€±á€¸á€á€»á€­á€”á€º</label>
                    <div id="netDisplay" class="main-ans">á€ á€€á€»á€•á€º á€ á€•á€² á€ á€›á€½á€±á€¸</div>
                    <div id="netSubDisplay" style="color:var(--text); font-size:1.1rem; margin-top:10px;">(0.0000 á€€á€»á€•á€º)</div>
                </div>
                <button class="btn-reset" onclick="resetNetWeight()">RESET</button>
            </div>

            <div id="price-result-view" class="hidden">
                <div id="capture-area" class="card" style="background:var(--card);">
                    <h2 id="res-title" style="text-align:center; border:none; color:var(--gold);">á€á€½á€€á€ºá€á€»á€€á€ºá€™á€¾á€¯á€™á€¾á€á€ºá€á€™á€ºá€¸</h2>
                    <div id="res-list"></div>
                </div>
                <button class="btn-main" style="background:#28a745; color:white;" onclick="saveAsPhoto()">ğŸ“· á€•á€¯á€¶á€¡á€–á€¼á€…á€ºá€á€­á€™á€ºá€¸á€™á€Šá€º</button>
                <button id="res-back-btn" class="btn-main" style="background:#444; color:white;" onclick="showView('price-calc')">á€”á€±á€¬á€€á€ºá€á€­á€¯á€·</button>
            </div>
        </div>
    </div>

    <script>
        // Constants from User Requirement
        const PURE_DENSITY = 19.25; // áá† á€•á€²á€›á€Šá€º (á€¡á€á€±á€«á€€á€º) density

        function toggleTheme() {
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            const meta = document.getElementById('theme-meta');
            if (body.getAttribute('data-theme') === 'dark') {
                body.setAttribute('data-theme', 'light');
                icon.innerText = "â˜€ï¸";
                meta.setAttribute('content', '#ffffff');
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                icon.innerText = "ğŸŒ™";
                meta.setAttribute('content', '#fcc103');
                localStorage.setItem('theme', 'dark');
            }
        }

        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('input', () => { if(input.id) localStorage.setItem(input.id, input.value); });
        });

        window.onload = () => {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.body.setAttribute('data-theme', savedTheme);
            document.getElementById('theme-icon').innerText = (savedTheme === 'dark') ? "ğŸŒ™" : "â˜€ï¸";
            inputs.forEach(input => {
                const savedValue = localStorage.getItem(input.id);
                if (savedValue && input.id) input.value = savedValue;
            });
            calculateNetWeight();
            updateEquivPrice();
        };

        function openNav() { document.getElementById("mySidebar").style.width = "280px"; document.getElementById("overlay").style.display = "block"; }
        function closeNav() { document.getElementById("mySidebar").style.width = "0"; document.getElementById("overlay").style.display = "none"; }

        function showView(view) {
            ['price-calc-view', 'diamond-calc-view', 'unit-converter-view', 'net-weight-view', 'price-result-view', 'purity-calc-view'].forEach(v => {
                const el = document.getElementById(v);
                if(el) el.classList.add('hidden');
            });
            document.getElementById(view + '-view').classList.remove('hidden');
            const title = document.getElementById('nav-title');
            if(view === 'diamond-calc') {
                title.innerText = "DIAMOND CALCULATOR";
                title.style.color = "var(--diamond)";
            } else {
                title.innerText = "SHWE CALCULATOR PRO";
                title.style.color = "var(--gold)";
            }
            closeNav();
            window.scrollTo(0,0);
        }

        function switchPurityTab(type) {
            document.getElementById('tab-purity').classList.toggle('active', type === 'purity');
            document.getElementById('tab-yield').classList.toggle('active', type === 'yield');
            document.getElementById('purity-sub-view').classList.toggle('hidden', type !== 'purity');
            document.getElementById('yield-sub-view').classList.toggle('hidden', type !== 'yield');
            document.getElementById('purity-result').classList.add('hidden');
        }

        function toDecimal(k, p, y) { return (parseFloat(k)||0) + ((parseFloat(p)||0)/16) + ((parseFloat(y)||0)/128); }

        function fromDecimal(decimal) {
            let k = Math.floor(decimal + 0.0000001);
            let remPe = (decimal - k) * 16;
            let p = Math.floor(remPe + 0.0000001);
            let y = parseFloat(((remPe - p) * 8).toFixed(2));
            if(y >= 8) { p++; y = 0; }
            if(p >= 16) { k++; p = 0; }
            return `${k} á€€á€»á€•á€º ${p} á€•á€² ${y} á€›á€½á€±á€¸`;
        }

        // Updated Purity Calculation using 19.25
        function calcPurity() {
            let raw = toDecimal(document.getElementById('p1-k').value, document.getElementById('p1-p').value, document.getElementById('p1-y').value);
            let pure = toDecimal(document.getElementById('p2-k').value, document.getElementById('p2-p').value, document.getElementById('p2-y').value);
            if(raw <= 0 || pure <= 0) return alert("á€¡á€œá€±á€¸á€á€»á€­á€”á€ºá€™á€¾á€”á€ºá€€á€”á€ºá€…á€½á€¬á€‘á€Šá€·á€ºá€•á€«á‹");
            
            let peYee = (pure / raw) * 16;
            let density = (pure / raw) * PURE_DENSITY; // Changed to 19.25

            document.getElementById('purity-result').classList.remove('hidden');
            document.getElementById('p-res-label').innerText = "á€á€½á€€á€ºá€á€»á€€á€ºá€›á€›á€¾á€­á€á€±á€¬ á€›á€½á€¾á€±á€¡á€›á€Šá€ºá€¡á€á€½á€±á€¸";
            document.getElementById('p-res-val').innerText = `${peYee.toFixed(2)} á€•á€²á€›á€Šá€º`;
            document.getElementById('p-res-detail').innerText = `Density (á€…á€€á€ºá€•á€½á€­á€¯á€„á€·á€º): ${density.toFixed(2)}`;
        }

        // Updated Yield Calculation using 19.25
        function calcYield() {
            let raw = toDecimal(document.getElementById('y1-k').value, document.getElementById('y1-p').value, document.getElementById('y1-y').value);
            let den = parseFloat(document.getElementById('y-den').value);
            let pe = parseFloat(document.getElementById('y-pe').value);
            let resultKyat = 0;
            
            if(den > 0) resultKyat = (den / PURE_DENSITY) * raw; // Changed to 19.25
            else if(pe > 0) resultKyat = (pe / 16) * raw;
            else return alert("Density (á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º) á€•á€²á€›á€Šá€º á€á€…á€ºá€á€¯á€á€¯á€‘á€Šá€·á€ºá€•á€«á‹");
            
            document.getElementById('purity-result').classList.remove('hidden');
            document.getElementById('p-res-label').innerText = "á€•á€¼á€”á€ºá€›á€™á€Šá€·á€º á€¡á€á€±á€«á€€á€ºá€›á€½á€¾á€±á€•á€™á€¬á€";
            document.getElementById('p-res-val').innerText = fromDecimal(resultKyat);
            document.getElementById('p-res-detail').innerText = `á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸á€’á€á€™á€€á€­á€”á€ºá€¸: ${resultKyat.toFixed(6)} á€€á€»á€•á€º`;
        }

        function updateEquivPrice() {
            const price = parseFloat(document.getElementById('DiamondPrice').value) || 0;
            const type = document.getElementById('DiamondPriceType').value;
            const display = document.getElementById('equivPriceDisplay');
            if (price === 0) { display.innerText = ""; return; }
            if (type === 'carat') display.innerText = `â‰ˆ ${Math.round(price / 1.1).toLocaleString()} á€€á€»á€•á€º (á á€›á€á€®á€œá€»á€¾á€„á€º)`;
            else display.innerText = `â‰ˆ ${Math.round(price * 1.1).toLocaleString()} á€€á€»á€•á€º (á á€€á€¬á€›á€€á€ºá€œá€»á€¾á€„á€º)`;
        }

        function syncDiamondUnits(mode) {
            let dr = document.getElementById('DR'), db = document.getElementById('DB'), dp = document.getElementById('DP'), dct = document.getElementById('DCt');
            if (mode === 'ct') {
                const ct = parseFloat(dct.value) || 0;
                const totalRatti = ct * 1.1;
                const r = Math.floor(totalRatti + 0.00001);
                const remB = (totalRatti - r) * 20;
                const b = Math.floor(remB + 0.00001);
                const p = parseFloat(((remB - b) * 8).toFixed(2));
                dr.value = r || ""; db.value = b || ""; dp.value = p > 0 ? p : "";
            } else {
                let r = parseFloat(dr.value) || 0, b = parseFloat(db.value) || 0, p = parseFloat(dp.value) || 0;
                if (p >= 8) { b += Math.floor(p / 8); p = parseFloat((p % 8).toFixed(2)); db.value = b; dp.value = p > 0 ? p : ""; }
                if (b >= 20) { r += Math.floor(b / 20); b = b % 20; dr.value = r; db.value = b > 0 ? b : ""; }
                const totalRatti = r + (b / 20) + (p / 160);
                dct.value = (totalRatti / 1.1).toFixed(4);
            }
        }

        function calculateDiamondPrice() {
            const price = parseFloat(document.getElementById('DiamondPrice').value) || 0;
            const type = document.getElementById('DiamondPriceType').value;
            const ct = parseFloat(document.getElementById('DCt').value) || 0;
            const r = parseFloat(document.getElementById('DR').value) || 0;
            const b = parseFloat(document.getElementById('DB').value) || 0;
            const p = parseFloat(document.getElementById('DP').value) || 0;
            const totalRatti = r + (b / 20) + (p / 160);
            let total = (type === 'carat') ? (ct * price) : (totalRatti * price);
            document.getElementById('res-title').innerText = "á€…á€­á€”á€º/á€›á€á€”á€¬ á€á€½á€€á€ºá€á€»á€€á€ºá€™á€¾á€¯";
            document.getElementById('res-title').style.color = "var(--diamond)";
            document.getElementById('res-back-btn').onclick = () => showView('diamond-calc');
            document.getElementById('res-list').innerHTML = `
                <div class="res-row"><span>á€á€á€ºá€™á€¾á€á€ºá€ˆá€±á€¸</span><span style="color:var(--diamond)">${price.toLocaleString()}</span></div>
                <div class="res-row"><span>á€¡á€œá€±á€¸á€á€»á€­á€”á€º (Ct)</span><span>${ct} Carat</span></div>
                <div class="res-row"><span>á€¡á€œá€±á€¸á€á€»á€­á€”á€º (R)</span><span>${r}R ${b}B ${p}P</span></div>
                <div class="res-row total-row" style="color:var(--diamond); background:rgba(185,242,255,0.1); border-color:var(--diamond);">
                    <span>${Math.round(total).toLocaleString()} á€€á€»á€•á€º</span>
                </div>
            `;
            showView('price-result');
        }

        function calculatePrice() {
            const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;
            const price = getVal('GoldPrice');
            const pk = getVal('PKat'), pp = getVal('PPe'), py = getVal('PYway');
            const rk = getVal('RKat'), rp = getVal('RPae'), ry = getVal('RYway');
            const goldKyat = toDecimal(pk, pp, py);
            const redKyat = toDecimal(rk, rp, ry);
            const smith = getVal('Smith'), stone = getVal('StonePrice');
            const total = (goldKyat * price) + (redKyat * price) + smith + stone;

            document.getElementById('res-title').innerText = "á€›á€½á€¾á€±á€á€½á€€á€ºá€á€»á€€á€ºá€™á€¾á€¯á€™á€¾á€á€ºá€á€™á€ºá€¸";
            document.getElementById('res-title').style.color = "var(--gold)";
            document.getElementById('res-back-btn').onclick = () => showView('price-calc');
            document.getElementById('res-list').innerHTML = `
                <div class="res-row"><span>á€šá€”á€±á€·á€›á€½á€¾á€±á€ˆá€±á€¸</span><span class="val-highlight">${price.toLocaleString()} á€€á€»á€•á€º</span></div>
                <div class="res-row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                    <div style="display: flex; justify-content: space-between; width: 100%;"><span>á€›á€½á€¾á€±á€–á€­á€¯á€¸</span><span class="val-highlight">${Math.round(goldKyat * price).toLocaleString()}</span></div>
                    <span style="font-size: 0.9rem; color: var(--label-text);">(á€¡á€œá€±á€¸á€á€»á€­á€”á€º: ${pk}K ${pp}P ${py}Y)</span>
                </div>
                <div class="res-row" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                    <div style="display: flex; justify-content: space-between; width: 100%;"><span>á€œá€»á€±á€¬á€·á€á€½á€€á€ºá€–á€­á€¯á€¸</span><span class="val-highlight">${Math.round(redKyat * price).toLocaleString()}</span></div>
                    <span style="font-size: 0.9rem; color: var(--label-text);">(á€¡á€œá€±á€¸á€á€»á€­á€”á€º: ${rk}K ${rp}P ${ry}Y)</span>
                </div>
                <div class="res-row"><span>á€œá€€á€ºá€ + á€€á€»á€±á€¬á€€á€º</span><span>${(smith + stone).toLocaleString()}</span></div>
                <div class="res-row total-row"><span>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸ - ${Math.round(total).toLocaleString()} á€€á€»á€•á€º</span></div>
            `;
            showView('price-result');
        }

        function calculateNetWeight() {
            const tk = parseFloat(document.getElementById('TKat').value) || 0, tp = parseFloat(document.getElementById('TPe').value) || 0, ty = parseFloat(document.getElementById('TYway').value) || 0;
            const sk = parseFloat(document.getElementById('SKat').value) || 0, sp = parseFloat(document.getElementById('SPe').value) || 0, sy = parseFloat(document.getElementById('SYway').value) || 0;
            const netDec = Math.max(0, toDecimal(tk, tp, ty) - toDecimal(sk, sp, sy));
            document.getElementById('netDisplay').innerText = fromDecimal(netDec);
            document.getElementById('netSubDisplay').innerText = `(${netDec.toFixed(4)} á€€á€»á€•á€º)`;
        }

        function convertUnits(source) {
            const factor = parseFloat(document.getElementById('standard').value);
            let kyatDec = (source === 'grams') ? (parseFloat(document.getElementById('gramsInput').value) || 0) / factor : toDecimal(document.getElementById('uKyat').value, document.getElementById('uPe').value, document.getElementById('uYway').value);
            document.getElementById('uDisplay').innerText = fromDecimal(kyatDec);
            document.getElementById('uSubDisplay').innerText = `(${kyatDec.toFixed(4)} á€€á€»á€•á€º) | ${(kyatDec * factor).toFixed(3)} g`;
            if (source === 'grams') {
                let parts = fromDecimal(kyatDec).match(/\d+(\.\d+)?/g);
                document.getElementById('uKyat').value = parts[0]; document.getElementById('uPe').value = parts[1]; document.getElementById('uYway').value = parts[2];
            } else document.getElementById('gramsInput').value = (kyatDec * factor).toFixed(3);
        }

        function convertDiamondUnits(mode) {
            if(mode === 'ct') {
                const ct = parseFloat(document.getElementById('convCt').value) || 0;
                document.getElementById('convGm').value = (ct * 0.2).toFixed(4);
            } else {
                const gm = parseFloat(document.getElementById('convGm').value) || 0;
                document.getElementById('convCt').value = (gm / 0.2).toFixed(4);
            }
        }

        function resetAllData() {
            if (confirm("á€’á€±á€á€¬á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€–á€»á€€á€ºá€•á€…á€ºá€›á€”á€º á€á€±á€á€»á€¬á€•á€«á€á€œá€¬á€¸?")) {
                document.querySelectorAll('input').forEach(i => i.value = "");
                localStorage.clear();
                if(document.getElementById('uDisplay')) document.getElementById('uDisplay').innerText = "á€ á€€á€»á€•á€º á€ á€•á€² á€ á€›á€½á€±á€¸";
                if(document.getElementById('uSubDisplay')) document.getElementById('uSubDisplay').innerText = "(0.0000 á€€á€»á€•á€º) | 0.000 g";
                if(document.getElementById('netDisplay')) document.getElementById('netDisplay').innerText = "á€ á€€á€»á€•á€º á€ á€•á€² á€ á€›á€½á€±á€¸";
                if(document.getElementById('netSubDisplay')) document.getElementById('netSubDisplay').innerText = "(0.0000 á€€á€»á€•á€º)";
                if(document.getElementById('purity-result')) document.getElementById('purity-result').classList.add('hidden');
                updateEquivPrice();
                closeNav();
                alert("á€’á€±á€á€¬á€¡á€¬á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ á€–á€»á€€á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®á‹");
            }
        }

        function resetCalculator() { document.querySelectorAll('#price-calc-view input').forEach(i => { i.value = ""; localStorage.removeItem(i.id); }); }
        function resetDiamond() { document.querySelectorAll('#diamond-calc-view input').forEach(i => { i.value = ""; localStorage.removeItem(i.id); }); updateEquivPrice(); }
        function resetConverter() { document.querySelectorAll('#unit-converter-view input').forEach(i => { i.value = ""; localStorage.removeItem(i.id); }); document.getElementById('uDisplay').innerText="á€ á€€á€»á€•á€º á€ á€•á€² á€ á€›á€½á€±á€¸"; }
        function resetNetWeight() { ['TKat','TPe','TYway','SKat','SPe','SYway'].forEach(id => { document.getElementById(id).value = ""; localStorage.removeItem(id); }); calculateNetWeight(); }
        
        document.getElementById('gramsInput').addEventListener('input', () => convertUnits('grams'));
        ['uKyat', 'uPe', 'uYway'].forEach(id => document.getElementById(id).addEventListener('input', () => convertUnits('units')));
        
        function saveAsPhoto() {
            html2canvas(document.getElementById("capture-area"), { backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--card'), scale: 2 }).then(canvas => {
                const link = document.createElement('a'); link.download = `ShweCalc_${Date.now()}.png`; link.href = canvas.toDataURL(); link.click();
            });
        }
    </script>
</body>
</html>
